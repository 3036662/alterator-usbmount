<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  </head>

    <h2>USBGuard</h2>

    <p>Модуль предназначен для настройки ограничений на использование USB-устройств.
      Модуль работает на основе функционала USBGuard, позволяет вести чёрный
      и белый списки ограничений и предоставляет два типа действий — allow/block.</p>

    <p>Данный модуль предоставляет следующие возможности:</p>
    <ul>
      <li>сканирование подключенных устройств;</li>
      <li>выбор и добавление устройств, из списка подключенных устройств, в набор правил;</li>
      <li>создание предустановленных правил для распространённых сценариев;</li>
      <li>создание правил по дескрипторам интерфейса: CC:SS:PP;</li>
      <li>создание правил по свойствам USB-устройства: PID, VID;</li>
      <li>создание правил по хэшу устройства по PID+VID+SN;</li>
      <li>создание сложных правил с дополнительными условиями;</li>
      <li>загрузка правил из csv-файла;</li>
      <li>редактирование значений в созданных правилах;</li>
      <li>просмотр журнала событий подключения/отключения USB-устройств.</li>
    </ul>

    <h3>Информационное поле</h3>

    <p>В информационном поле отображается текущее состояние службы usbguard,
      список пользователей и групп, которые могут редактировать правила,
      сообщения об ошибках и предупреждения.</p>

    <p>Для включения контроля за USB-устройствами необходимо установить отметку
      в пункте <strong>Активировать контроль портов</strong>,
      нажать кнопку <strong>Проверить</strong>,
      а затем кнопку <strong>Применить</strong>
      (служба usbguard будет запущена и добавлена в автозагрузку).</p>

    <h3>Список USB-устройств</h3>

    <p>Если служба usbguard запущена, в таблице <strong>Список устройств</strong>
      будет отображён список подключённых USB-устройств.</p>

    <p>В столбце <strong>Статус</strong> таблицы <strong>Список устройств</strong>
      отображается текущее состояние USB-устройства («allow» — разрешённое устройство,
      «block» — заблокированное устройство).</p>

    <p>Для редактирования состояния устройства, необходимо выделить строку
      с USB-устройством и нажать кнопку <strong>Разблокировать</strong>/<strong>Заблокировать</strong>.
      При этом соответствующее правило будет добавлено в таблицу <strong>Хэш</strong>.</p>

    <p><strong>Примечание:</strong> если активен белый список,
      то для устройства со статусом «block» будет активна кнопка <strong>Разблокировать</strong>,
      если активен чёрный список, то для устройства со статусом «allow»
      будет активна кнопка <strong>Заблокировать</strong>.</p>

    <p>Кнопка <strong>Сканировать</strong> позволяет обновить список подключённых USB-устройств.</p>

    <h3>Добавление/удаление правил</h3>

    <h4>Предустановки</h4>

    <p>Правила могут работать в режиме белого или чёрного списка.
      После установки режима <strong>Чёрный список</strong>, будут заблокированы
      только перечисленные в данном списке USB-устройства.
      А после установки режима <strong>Белый список</strong>,
      будут заблокированы все USB-устройства, кроме перечисленных в данном списке.</p>

    <p>Кроме ручного режима добавления правил в списки существует
      возможность предварительной настройки списков:</p>
    <ul>
      <li><strong>Заблокировать все, кроме подключенных устройств</strong> — в
      правила (таблица <strong>Хэш</strong>) с действием «allow» будут добавлены
      все подключенные устройства. Все новые USB-устройства будут заблокированы;</li>
      <li><strong>Заблокировать все, кроме подключенных и HID/HUB устройств</strong> — в
      правила с действием «allow» будут добавлены все подключенные устройства
      (таблица <strong>Хэш</strong>) и все устройства с интерфейсами 03:*:* и 09:*:*
      (таблица <strong>Маски CC:SS:PP</strong>). Все новые USB-устройства
      за исключением HID/HUB-устройств (клавиатуры, мыши, джойстики, USB-концентраторы)
      будут заблокированы;</li>
      <li><strong>Блокировать устройства по классам дескриптора интерфейса: 06 Image и 08 Mass Storage</strong> — в
      правила (таблица <strong>Маски CC:SS:PP</strong>) с действием «block»
      будут добавлены все устройства с интерфейсами 08:*:* и 06:*:*. В результате
      все USB-устройства Mass Storage Device (USB-накопитель, карта памяти, кардридер, цифровая фотокамера)
      и Image (веб-камера, сканер) будут заблокированы;</li>
      <li><strong>Блокировать устройства по списку известных PID:VID,
      использующих Аndroid Debug Bus</strong> — в правила (таблица <strong>Маски VID:PID</strong>)
      с действием «block» будут добавлены известные Android-устройства.
      В результате все Android-устройства будут заблокированы.</li>
    </ul>

    <p>После добавления/удаления правил следует нажать кнопку <strong>Проверить</strong>
      (будут показаны планируемые изменения), а затем кнопку <strong>Применить</strong>
      (правила будут применены).</p>

    <h4>Ручной режим</h4>

    <p>Для добавления нового правила должен быть выбран пункт <strong>Ручной режим</strong>
      в белом или чёрном списках. Если <strong>Ручной режим</strong> выбран в белом списке,
      правило будет добавлено с действием «allow», если в чёрном — с действием «block».</p>

    <p>В ручном режиме можно добавить правила в таблицы:</p>
    <ul>
      <li><strong>Другие правила</strong> — позволяет добавить правила со сложными условиями;</li>
      <li><strong>Маски CC:SS:PP</strong> — позволяет добавить правила по типу интерфейса,
      предоставляемому USB-устройством. Тип интерфейса указывается как три 8-битных
      числа в шестнадцатеричном формате, разделенных двоеточием (cc:ss:pp).
      Числа обозначают класс интерфейса (cc), подкласс (ss) и протокол (pp).
      Вместо номера подкласса и протокола можно использовать символ *;</li>
      <li><strong>Маски VID:PID</strong> — позволяет добавить правила по
      идентификатору разработчика устройства (VID) и идентификатору изделия (PID).
      Вместо VID и PID можно использовать символ *;</li>
      <li><strong>Хэш</strong> — позволяет добавить правила по хэшу, вычисленному на основе
      значений атрибутов устройства и данных дескриптора USB (PID+VID+SN).</li>
    </ul>

    <p>Добавление правил:</p>
    <ol>
      <li>Нажать кнопку <strong>Добавить</strong>,
        расположенную под соответствующей таблицей.</li>
      <li>Вписать маску.</li>
      <li>Нажать кнопку <strong>Проверить</strong>
      (корректное правило будет выделено зелёным цветом, не корректное — красным).</li>
      <li>Нажать кнопку <strong>Применить</strong>.</li>
    </ol>

    <p>Удаление правила:</p>
    <ol>
      <li>В соответствующей таблице установить отметку
      в поле с правилом, которое необходимо удалить.</li>
      <li>Нажать кнопку <strong>Удалить</strong>.</li>
      <li>Нажать кнопку <strong>Проверить</strong>.</li>
      <li>Нажать кнопку <strong>Применить</strong>.</li>
    </ol>

    <h4>Загрузка правил из файла</h4>

    <p>Правила должны быть добавлены в csv-файл, по одному правилу в каждой строке.
      Строка должна иметь вид <em>allow/block,Interface,PID:VID,Hash</em>.
    </p>

    <p><strong>Внимание!</strong> Файл не должен содержать конфликтные
    правила — должны быть либо все allow, либо все block.</p>

    <p>Загрузка правил из файла:</p>
    <ol>
      <li>Нажать кнопку <strong>Обзор</strong> и выбрать файл с правилами.</li>
      <li>Нажать кнопку <strong>Загрузить из файла</strong>.</li>
      <li>Нажать кнопку <strong>Проверить</strong>.</li>
      <li>Нажать кнопку <strong>Применить</strong>.</li>
    </ol>

    <h3>Просмотр журнала аудита</h3>

    <p>Для просмотра журнала аудита необходимо нажать кнопку <strong>Журнал</strong>,
    расположенную в левом нижнем углу модуля. Будет раскрыт журнал аудита.</p>

    <p>Передвигаться по журналу к более старым или более новым записям можно
    с помощью кнопок <strong>Назад</strong> и <strong>Вперёд</strong>.
    Отфильтровать записи можно с помощью поля <strong>Фильтровать</strong>.</p>

    <p>Для того чтобы скрыть панель журнала, необходимо нажать кнопку
    <strong>Свернуть</strong>.</p>

  </body>
</html>
